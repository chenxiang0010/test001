$((function(){$(".content_list").mCustomScrollbar();let $audio=$("audio"),player=new Player($audio),progress,voiceProgress,lyric;function getPlayerList(){$.ajax({url:"./source/musicList.json",dataType:"json",success:function(data){player.musicList=data;let $musicList=$(".content_list ul");$.each(data,(function(index,ele){let $item=crateMusicItem(index,ele);$musicList.append($item)})),initMusicInfo(data[0]),initMusicLyric(data[0])},error:function(e){console.log(e)}})}function initMusicInfo(music){let $musicImage=$(".song_info_pic img"),$musicName=$(".song_info_name a"),$musicSinger=$(".song_info_singer a"),$musicAlbum=$(".song_info_album a"),$musicProgressName=$(".music_progress_name"),$musicProgressTime=$(".music_progress_time"),$musicBg=$(".mask_bg");$musicImage.attr("src",music.cover),$musicName.text(music.name),$musicSinger.text(music.singer),$musicAlbum.text(music.album),$musicProgressName.text(music.name+" / "+music.singer),$musicProgressTime.text("00:00 / "+music.time),$musicBg.css("background","url('"+music.cover+"')")}function initMusicLyric(music){lyric=new Lyric(music.link_lrc);let $lyricContainer=$(".song_lyric");$lyricContainer.html(""),lyric.loadLyric((function(){$.each(lyric.lyrics,(function(index,ele){let $item=$("<li>"+ele+"</li>");$lyricContainer.append($item)}))}))}function initProgress(){let $progressBar=$(".music_progress_bar"),$progressLine=$(".music_progress_line"),$progressDot=$(".music_progress_dot");progress=Progress($progressBar,$progressLine,$progressDot),progress.progressClick((function(value){player.musicSeekTo(value)})),progress.progressMove((function(value){player.musicSeekTo(value)}));let $voiceBar=$(".music_voice_bar"),$voiceLine=$(".music_voice_line"),$voiceDot=$(".music_voice_dot");voiceProgress=Progress($voiceBar,$voiceLine,$voiceDot),voiceProgress.progressClick((function(value){player.musicVoiceSeekTo(value)})),voiceProgress.progressMove((function(value){player.musicVoiceSeekTo(value)}))}function initEvents(){$(".content_list").delegate(".list_music","mouseenter",(function(){$(this).find(".list_menu").stop().fadeIn(100),$(this).find(".list_time a").stop().fadeIn(1),$(this).find(".list_time span").stop().fadeOut(1)})),$(".content_list").delegate(".list_music","mouseleave",(function(){$(this).find(".list_menu").stop().fadeOut(100),$(this).find(".list_time a").stop().fadeOut(1),$(this).find(".list_time span").stop().fadeIn(1)})),$(".content_list").delegate(".list_check","click",(function(){$(this).toggleClass("list_checked")}));let $musicPlay=$(".music_play");$(".content_list").delegate(".list_menu_play","click",(function(){let $item=$(this).parents(".list_music");$(this).toggleClass("list_menu_play2"),$item.siblings().find(".list_menu_play").removeClass("list_menu_play2"),$(this).hasClass("list_menu_play2")?($musicPlay.addClass("music_play2"),$item.find("div").css("color","#fff"),$item.siblings().find("div").css("color","rgba(255,255,255,.5)")):($musicPlay.removeClass("music_play2"),$item.find("div").css("color","rgba(255,255,255,.5)")),$item.find(".list_number").toggleClass("list_number2"),$item.siblings().find(".list_number").removeClass("list_number2"),player.playMusic($item.get(0).index,$item.get(0).music),initMusicInfo($item.get(0).music),initMusicLyric($item.get(0).music)})),$musicPlay.click((function(){-1==player.currentIndex?$(".list_music").eq(0).find(".list_menu_play").trigger("click"):$(".list_music").eq(player.currentIndex).find(".list_menu_play").trigger("click")})),$(".music_pre").click((function(){$(".list_music").eq(player.preIndex()).find(".list_menu_play").trigger("click")})),$(".music_next").click((function(){$(".list_music").eq(player.nextIndex()).find(".list_menu_play").trigger("click")})),$(".content_list").delegate(".list_menu_del","click",(function(){let $item=$(this).parents(".list_music");$item.get(0).index==player.currentIndex&&$(".music_next").trigger("click"),$item.remove(),player.changeMusic($item.get(0).index),$(".list_music").each((function(index,ele){ele.index=index,$(ele).find(".list_number").text(index+1)}))})),player.musicTimeUpdate((function(currentTime,duration,timeStr){$(".music_progress_time").text(timeStr);let value=currentTime/duration*100;progress.setProgress(value);let index=lyric.currentIndex(currentTime),$item=$(".song_lyric li").eq(index);$item.addClass("cur"),$item.siblings().removeClass("cur"),index<=2||$(".song_lyric").css({marginTop:30*(2-index)})})),$(".music_voice_icon").click((function(){$(this).toggleClass("music_voice_icon2"),$(this).hasClass("music_voice_icon2")?player.musicVoiceSeekTo(0):player.musicVoiceSeekTo(1)}))}function crateMusicItem(index,music){let $item=$('<li class="list_music">\n<div class="list_check"><i></i></div>\n<div class="list_number">'+(index+1)+'</div>\n<div class="list_name">'+music.name+'     <div class="list_menu">\n          <a href="javascript:;" title="播放" class=\'list_menu_play\'></a>\n          <a href="javascript:;" title="添加"></a>\n          <a href="javascript:;" title="下载"></a>\n          <a href="javascript:;" title="分享"></a>\n     </div>\n</div>\n<div class="list_singer">'+music.singer+'</div>\n<div class="list_time">\n     <span>'+music.time+'</span>\n     <a href="javascript:;" title="删除" class=\'list_menu_del\'></a>\n</div>\n</li>');return $item.get(0).index=index,$item.get(0).music=music,$item}getPlayerList(),initProgress(),initEvents()}));